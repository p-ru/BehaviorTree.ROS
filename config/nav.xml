<?xml version="1.0" encoding="UTF-8"?>
<root>
    <BehaviorTree ID="WaypointNavigation">
        <ReactiveSequence name="Mission">
            <WaypointManager 
                segment_completed="{segment_completed}"

                current_waypoint="{current_waypoint}"
                waypoint_index="{waypoint_index}"
                has_more_waypoints="{has_more_waypoints}"
                waypoint_count="{waypoint_count}"/>
            <RosSubscriptionManager 
                tags="{tags}"
                heartbeat="{heartbeat}"
                tagslam_odom="{tagslam_odom}"/>
            
            
            <Sequence name="Segment">
                <StartSegment 
                    segment_completed="{segment_completed}"/>

                <Sequence name="Tasks">
                
                        <ReactiveSequence>
                            <GoalManager 
                                tagslam_odom="{tagslam_odom}"
                                current_waypoint="{current_waypoint}"
                                waypoint_reached="{waypoint_reached}"/>
                            <WhileDoElse> 
                                <IsTagslamHealthy 
                                heartbeat="{heartbeat}"
                                tags="{tags}"
                                is_healthy="{is_healthy}"/>
                                <Sequence name="Initialize and approach waypoint">
                                    <SleepNode
                                        msec="500"/>
                                    <PublishWaypoint 
                                        current_waypoint="{current_waypoint}"/>
                                    <EnableTrajGen enable_trajgen="True"/>
                                    <ApproachWaypoint 
                                        current_waypoint="{current_waypoint}"
                                        waypoint_reached="{waypoint_reached}"
                                        is_healthy="{is_healthy}"/>
                                </Sequence>
                                <SleepNode
                                    msec="9999"/>
                            </WhileDoElse> 
                            <GoalStateTracker 
                                waypoint_reached="{waypoint_reached}"
                                current_waypoint="{current_waypoint}"/>

                        </ReactiveSequence>

                        



                    <PerformAction name="RotateGimbalDown"
                        service_name="{service_name}"
                        request_data='action.GIMBAL.RotateByAngle.{"mode":1,"pitch":-70,"roll":0,"yaw":0,"pitchIgnored":false,"rollIgnored":false,"yawIgnored":false,"duration":0.5,"jointReferenceUsed":false,"timeout":0}'
                        topic_name="{topic_name}"
                        success_condition="RotateByAngle.success"
                        received_data="{received_data}"/>
                    <SleepNode
                        msec="500"/>
                    
                    <PerformAction name="StartShootPhoto"
                        service_name="{service_name}"
                        request_data='action.CAMERA.StartShootPhoto.'
                        topic_name="{topic_name}"
                        success_condition="StartShootPhoto.success"
                        received_data="{received_data}"/>
                    <SleepNode
                        msec="500"/>
                    <PerformAction name="RotateGimbalUp"
                        service_name="{service_name}"
                        request_data='action.GIMBAL.RotateByAngle.{"mode":1,"pitch":0,"roll":0,"yaw":0,"pitchIgnored":false,"rollIgnored":false,"yawIgnored":false,"duration":0.5,"jointReferenceUsed":false,"timeout":0}'
                        topic_name="{topic_name}"
                        success_condition="RotateByAngle.success"
                        received_data="{received_data}"/>
                    <SleepNode
                        msec="500"/>
                </Sequence>
              
                <EndSegment 
                    segment_completed="{segment_completed}"/>
            </Sequence>
            
            <MissionStateTracker 
                end_condition="{has_more_waypoints}"/>
            
        </ReactiveSequence>
    </BehaviorTree>
</root>
